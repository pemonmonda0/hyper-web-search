

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Hyper Web Search</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  :root{--blue:#2166ff;--gray:#f2f3f5;}
  body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;margin:20px;max-width:480px}
  h1{font-size:1.6rem;margin-bottom:1rem}
  .row{display:flex;gap:.5rem;margin-bottom:1rem}
  input[type="text"]{flex:1;padding:.6rem;border:1px solid #ccc;border-radius:.3rem;font-size:1rem}
  button.search{padding:.6rem 1.2rem;font-size:1rem;color:#fff;background:var(--blue);border:none;border-radius:.3rem;cursor:pointer}
  .sites{display:flex;flex-direction:column;gap:.25rem;margin-bottom:1.5rem}
  .sites label{display:flex;align-items:center;gap:.4rem;font-size:.94rem}
  .sites input{accent-color:var(--blue)}
  .hist{margin-top:1.5rem}
  .hist h2{font-size:.95rem;margin-bottom:.4rem}
  .hist ul{list-style:disc;margin:0;padding-left:1.2rem}
  .hist li{cursor:pointer;color:#0366d6}
</style>
</head>
<body>

<h1>Hyper Web Search</h1>

<!-- 1 行で検索ボックス＋ボタン -->
<div class="row">
  <input id="kw" type="text" placeholder="商品名 / JAN / 型番">
  <button class="search" onclick="handleSearch()">検索</button>
</div>

<!-- サイトチェックボックス -->
<div id="sitesBox" class="sites"></div>

<!-- 履歴 -->
<div class="hist">
  <h2>履歴の一覧：</h2>
  <ul id="histList"></ul>
</div>

  <script>
/* ---- 以前の Service Worker を完全解除 ---- */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations()
    .then(regs => regs.forEach(reg => reg.unregister()));
}
</script>

<script>
// ------------------- 設定 -------------------
const SITES = [
  { id:'rakuten', label:'楽天',   url:q=>`https://search.rakuten.co.jp/search/mall/${q}/` },
  { id:'yahoo',   label:'Yahoo',  url:q=>`https://shopping.yahoo.co.jp/search?p=${q}` },
  { id:'amazon',  label:'Amazon', url:q=>`https://www.amazon.co.jp/s?k=${q}` },
  { id:'mercari', label:'メルカリ',url:q=>`https://jp.mercari.com/search?keyword=${q}` },
  { id:'yafuoku', label:'ヤフフリ',url:q=>`https://auctions.yahoo.co.jp/search/search?p=${q}` },
  { id:'rakuma',  label:'ラクマ', url:q=>`https://fril.jp/s?query=${q}` }
];
const MAX_HIST = 10;

// ------------------- UI 初期化 -------------------
const sitesBox  = document.getElementById('sitesBox');
const histList  = document.getElementById('histList');
const kwInput   = document.getElementById('kw');

SITES.forEach(s=>{
  sitesBox.insertAdjacentHTML('beforeend',`
    <label><input type="checkbox" id="${s.id}" checked> ${s.label}</label>
  `);
});
renderHist();

// ------------------- 検索 -------------------
function handleSearch(){
  const kw = kwInput.value.trim();
  if(!kw){ kwInput.focus(); return; }
  const q = encodeURIComponent(kw);

  SITES.forEach(s=>{
    if(document.getElementById(s.id).checked){
      window.open(s.url(q),'_blank');
    }
  });
  storeHist(kw);
}

// ------------------- 履歴 -------------------
function storeHist(kw){
  let h = JSON.parse(localStorage.getItem('hist')||'[]');
  h = h.filter(x=>x!==kw);      // 重複削除
  h.unshift(kw);                // 先頭挿入
  h = h.slice(0,MAX_HIST);      // 上限
  localStorage.setItem('hist',JSON.stringify(h));
  renderHist();
}

function renderHist(){
  histList.innerHTML='';
  const h = JSON.parse(localStorage.getItem('hist')||'[]');
  h.forEach(w=>{
    const li=document.createElement('li');
    li.textContent=w;
    li.onclick=()=>{ kwInput.value=w; };
    histList.appendChild(li);
  });
}
</script>
</body>
</html>

<script>
  
/* ===================== 1. 検索対象サイト設定 ===================== */
const SITES = [
  { id:'rakuten', label:'楽天',    color:'bg-red-500'   ,
    url:q=>`https://search.rakuten.co.jp/search/mall/${q}/?s=2`             },
  { id:'yahoo',   label:'Yahoo',   color:'bg-yellow-500',
    url:q=>`https://shopping.yahoo.co.jp/search?p=${q}&ss_sort=%2Bprice`    },
  { id:'amazon',  label:'Amazon',  color:'bg-neutral-800',
    url:q=>`https://www.amazon.co.jp/s?k=${q}&s=price-asc-rank`             },
  { id:'mercari', label:'メルカリ', color:'bg-orange-500',
    url:q=>`https://jp.mercari.com/search?keyword=${q}&sort=price_asc`      },
  { id:'yafuri',  label:'ヤフフリ', color:'bg-amber-700',
    url:q=>`https://auctions.yahoo.co.jp/search/search?p=${q}&slider=price` },
  { id:'rakuma',  label:'ラクマ',   color:'bg-pink-600' ,
    url:q=>`https://fril.jp/s?query=${q}&order=price_asc`                   }
];

/* ===================== 2. トグル（チェックボックス）生成 ===================== */
function buildSiteToggles(){
  const box = document.getElementById('siteBox');
  SITES.forEach(s=>{
    box.insertAdjacentHTML('beforeend', `
      <label class="flex items-center gap-1 cursor-pointer">
        <input type="checkbox" id="chk_${s.id}" class="accent-blue-600" checked>
        <span class="text-white ${s.color} px-3 py-1 rounded select-none">${s.label}</span>
      </label>
    `);
  });
}

/* ===================== 3. 検索実行 ===================== */
function openTabs(){
  const kw = document.getElementById('kw').value.trim();
  if(!kw){ alert('キーワードを入力してください'); return; }

  const q = encodeURIComponent(kw);
  SITES.forEach(s=>{
    if(document.getElementById(`chk_${s.id}`).checked){
      window.open(s.url(q), '_blank'+Math.random(), 'noopener');
    }
  });
  saveHist(kw);
}

/* ===================== 4. 直近10件ローカル履歴 ===================== */
function saveHist(kw){
  let hist = JSON.parse(localStorage.hist||'[]');
  hist = hist.filter(x=>x!==kw);   // 重複排除
  hist.unshift(kw);                // 先頭に追加
  hist = hist.slice(0,10);         // 10件制限
  localStorage.hist = JSON.stringify(hist);
  renderHist();
}

function renderHist(){
  const box  = document.getElementById('histBox');
  const data = JSON.parse(localStorage.hist||'[]');
  box.innerHTML='';
  data.forEach(k=>{
    box.insertAdjacentHTML('beforeend', `
      <button class="px-4 py-1 rounded-full bg-gray-200 hover:bg-gray-300"
              onclick="document.getElementById('kw').value='${k}'">
        ${k}
      </button>
    `);
  });
}

/* ===================== 初期化 ===================== */
buildSiteToggles();
renderHist();
document.getElementById('btnSearch').addEventListener('click', openTabs);
document.getElementById('kw').addEventListener('keydown', e=>{
  if(e.key==='Enter') openTabs();
});
</script>
</body>
</html>
